<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Almoxarifado EPI - Sistema Multi-Estoque v3.0</title>
    <meta name="theme-color" content="#0F172A">
    
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Work+Sans:wght@300;400;600;700;800&display=swap');
        
        body { 
            -webkit-tap-highlight-color: transparent; 
            overscroll-behavior-y: none;
            font-family: 'Work Sans', sans-serif;
        }
        
        .font-mono { font-family: 'Space Mono', monospace; }
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        
        .bg-gradient-dark {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
    </style>
</head>
<body class="bg-gradient-dark text-gray-100">
    <div id="app"></div>
    
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="text-center">
            <i class="ph ph-spinner animate-spin text-6xl text-emerald-400"></i>
            <p class="text-xl mt-4" id="loadingMessage">Processando...</p>
        </div>
    </div>

    <script>
        // ‚ö†Ô∏è IMPORTANTE: SUBSTITUA PELA SUA URL DO GOOGLE APPS SCRIPT
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz-xO56iWqs5zFYCndfQcqWJL5AdCOyxO6v8RUqnQPkgcOMUPWeCydQedJC5MVjrS8X8g/exec';
        
        // TIPOS DE MOVIMENTA√á√ÉO
        const MOVEMENT_TYPES = {
            'ENTRADA': { label: 'Entrada', color: 'emerald', icon: 'arrow-down-left' },
            'SAIDA': { label: 'Sa√≠da', color: 'red', icon: 'arrow-up-right' },
            'DISTRIBUICAO': { label: 'Distribui√ß√£o', color: 'blue', icon: 'hand-coins' },
            'AJUSTE': { label: 'Ajuste', color: 'amber', icon: 'wrench' },
            'TRANSFERENCIA': { label: 'Transfer√™ncia', color: 'indigo', icon: 'swap' }
        };

        // ESTADO DA APLICA√á√ÉO
        let state = {
            view: 'login',
            user: null,
            currentAlmoxarifado: 'ALM1',
            items: [],
            movements: [],
            statistics: null,
            
            filters: {
                startDate: getFirstDayOfMonth(),
                endDate: getCurrentDate(),
                type: 'TODOS',
                almoxarifado: 'TODOS',
                searchTerm: ''
            },
            
            distributionOperation: {
                active: false,
                selectedItem: null,
                employeeName: '',
                quantity: 1,
                observations: ''
            },
            
            transferOperation: {
                active: false,
                selectedItem: null,
                origem: 'ALM2',
                destino: 'ALM1',
                quantity: 1,
                observations: ''
            },
            
            editingItem: null,
            currentPage: 1,
            itemsPerPage: 50
        };

        // UTILIT√ÅRIOS
        function getCurrentDate() {
            return new Date().toISOString().split('T')[0];
        }

        function getFirstDayOfMonth() {
            const now = new Date();
            return new Date(now.getFullYear(), now.getMonth(), 1).toISOString().split('T')[0];
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('pt-BR');
        }

        function formatDateTime(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toLocaleString('pt-BR');
        }

        function showLoading(message = 'Processando...') {
            const overlay = document.getElementById('loadingOverlay');
            const messageEl = document.getElementById('loadingMessage');
            if (overlay && messageEl) {
                messageEl.textContent = message;
                overlay.classList.remove('hidden');
            }
        }

        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.classList.add('hidden');
            }
        }

        function getColorClass(color) {
            const colors = {
                emerald: 'bg-emerald-500/20 border-emerald-500 text-emerald-400',
                red: 'bg-red-500/20 border-red-500 text-red-400',
                blue: 'bg-blue-500/20 border-blue-500 text-blue-400',
                amber: 'bg-amber-500/20 border-amber-500 text-amber-400',
                indigo: 'bg-indigo-500/20 border-indigo-500 text-indigo-400'
            };
            return colors[color] || 'bg-slate-500/20 border-slate-500 text-slate-400';
        }

        // API CALLS
        async function apiCall(endpoint, params = {}, isPost = false) {
            try {
                let url = GOOGLE_SCRIPT_URL;
                
                if (isPost) {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'text/plain' },
                        body: JSON.stringify(params)
                    });
                    return await response.json();
                } else {
                    const queryString = new URLSearchParams(params).toString();
                    const response = await fetch(`${url}?${queryString}`);
                    return await response.json();
                }
            } catch (error) {
                console.error('API Error:', error);
                return { success: false, error: error.message };
            }
        }

        async function login(username, password) {
            return await apiCall('', { action: 'login', username, password });
        }

        async function getItems(almoxarifado = 'ALM1') {
            return await apiCall('', { action: 'getItems', almoxarifado });
        }

        async function saveItem(item) {
            return await apiCall('', { action: 'saveItem', item }, true);
        }

        async function deleteItem(itemId, almoxarifado) {
            return await apiCall('', { action: 'deleteItem', itemId, almoxarifado }, true);
        }

        async function saveMovement(movement) {
            return await apiCall('', { action: 'saveMovement', movement }, true);
        }

        async function transferBetweenStocks(transfer) {
            return await apiCall('', { action: 'transferBetweenStocks', transfer }, true);
        }

        async function getMovements(filters) {
            return await apiCall('', {
                action: 'getMovements',
                startDate: filters.startDate,
                endDate: filters.endDate,
                type: filters.type,
                almoxarifado: filters.almoxarifado
            });
        }

        async function getStatistics(almoxarifado = 'TODOS') {
            return await apiCall('', { action: 'getStatistics', almoxarifado });
        }

        // L√ìGICA DE NEG√ìCIO
        async function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (!username || !password) {
                alert('Preencha todos os campos');
                return;
            }

            showLoading('Autenticando...');

            const result = await login(username, password);

            if (result.success) {
                state.user = result.user;
                localStorage.setItem('user', JSON.stringify(result.user));
                
                showLoading('Carregando dados...');
                await loadItems();
                await loadStatistics();
                
                state.view = 'dashboard';
                hideLoading();
                render();
            } else {
                hideLoading();
                alert('Login falhou: ' + (result.error || 'Credenciais inv√°lidas'));
            }
        }

        async function loadItems() {
            const result = await getItems(state.currentAlmoxarifado);
            if (result.success) {
                state.items = result.items;
            }
        }

        async function loadMovements() {
            const result = await getMovements(state.filters);
            if (result.success) {
                state.movements = result.movements;
                state.currentPage = 1;
            }
        }

        async function loadStatistics() {
            const result = await getStatistics(state.currentAlmoxarifado);
            if (result.success) {
                state.statistics = result.statistics;
            }
        }

        function handleLogout() {
            localStorage.removeItem('user');
            state = {
                view: 'login',
                user: null,
                currentAlmoxarifado: 'ALM1',
                items: [],
                movements: [],
                statistics: null,
                filters: {
                    startDate: getFirstDayOfMonth(),
                    endDate: getCurrentDate(),
                    type: 'TODOS',
                    almoxarifado: 'TODOS',
                    searchTerm: ''
                },
                distributionOperation: {
                    active: false,
                    selectedItem: null,
                    employeeName: '',
                    quantity: 1,
                    observations: ''
                },
                transferOperation: {
                    active: false,
                    selectedItem: null,
                    origem: 'ALM2',
                    destino: 'ALM1',
                    quantity: 1,
                    observations: ''
                },
                editingItem: null,
                currentPage: 1,
                itemsPerPage: 50
            };
            render();
        }

        // DISTRIBUI√á√ÉO
        function startDistribution() {
            state.distributionOperation.active = true;
            state.view = 'distribution';
            render();
        }

        function cancelDistribution() {
            state.distributionOperation = {
                active: false,
                selectedItem: null,
                employeeName: '',
                quantity: 1,
                observations: ''
            };
            state.view = 'dashboard';
            render();
        }

        async function confirmDistribution() {
            const op = state.distributionOperation;
            
            if (!op.selectedItem || !op.employeeName || op.quantity <= 0) {
                alert('Preencha todos os campos obrigat√≥rios');
                return;
            }

            const item = state.items.find(i => i.id === op.selectedItem);
            if (!item) {
                alert('Item n√£o encontrado');
                return;
            }

            if (item.quantidade < op.quantity) {
                alert('Quantidade insuficiente');
                return;
            }

            showLoading('Registrando distribui√ß√£o...');

            const movement = {
                date: getCurrentDate(),
                type: 'DISTRIBUICAO',
                itemId: item.id,
                itemName: item.nome,
                quantity: op.quantity,
                employee: op.employeeName,
                user: state.user.nome,
                observations: op.observations,
                almoxarifado: state.currentAlmoxarifado
            };

            const result = await saveMovement(movement);

            if (result.success) {
                await loadItems();
                await loadStatistics();
                hideLoading();
                alert('‚úÖ Distribui√ß√£o registrada!');
                cancelDistribution();
            } else {
                hideLoading();
                alert('Erro: ' + result.error);
            }
        }

        // TRANSFER√äNCIA
        function startTransfer() {
            state.transferOperation.active = true;
            state.view = 'transfer';
            render();
        }

        function cancelTransfer() {
            state.transferOperation = {
                active: false,
                selectedItem: null,
                origem: 'ALM2',
                destino: 'ALM1',
                quantity: 1,
                observations: ''
            };
            state.view = 'dashboard';
            render();
        }

        async function confirmTransfer() {
            const op = state.transferOperation;
            
            if (!op.selectedItem || op.quantity <= 0) {
                alert('Preencha todos os campos');
                return;
            }

            if (op.origem === op.destino) {
                alert('Origem e destino devem ser diferentes');
                return;
            }

            showLoading('Processando transfer√™ncia...');

            const origemItems = await getItems(op.origem);
            if (!origemItems.success) {
                hideLoading();
                alert('Erro ao buscar itens de origem');
                return;
            }

            const item = origemItems.items.find(i => i.id === op.selectedItem);
            if (!item) {
                hideLoading();
                alert('Item n√£o encontrado no almoxarifado de origem');
                return;
            }

            if (item.quantidade < op.quantity) {
                hideLoading();
                alert('Quantidade insuficiente no almoxarifado de origem');
                return;
            }

            const transfer = {
                itemId: item.id,
                itemName: item.nome,
                quantity: op.quantity,
                origem: op.origem,
                destino: op.destino,
                user: state.user.nome,
                observations: op.observations
            };

            const result = await transferBetweenStocks(transfer);

            if (result.success) {
                await loadItems();
                await loadStatistics();
                hideLoading();
                alert('‚úÖ Transfer√™ncia realizada!');
                cancelTransfer();
            } else {
                hideLoading();
                alert('Erro: ' + result.error);
            }
        }

        // EDI√á√ÉO DE ITENS
        function openNewItem() {
            state.editingItem = null;
            state.view = 'editItem';
            render();
        }

        function openEditItem(item) {
            state.editingItem = item;
            state.view = 'editItem';
            render();
        }

        async function handleSaveItem(e) {
            e.preventDefault();
            
            const itemData = {
                id: state.editingItem?.id || 'ITEM-' + Date.now(),
                nome: document.getElementById('itemName').value,
                categoria: document.getElementById('itemCategory').value,
                quantidade: parseInt(document.getElementById('itemQuantity').value),
                unidade: document.getElementById('itemUnit').value,
                ca: document.getElementById('itemCA').value,
                validade: document.getElementById('itemValidity').value,
                localizacao: document.getElementById('itemLocation').value,
                observacoes: document.getElementById('itemObs').value,
                almoxarifado: state.currentAlmoxarifado
            };

            showLoading('Salvando item...');

            const result = await saveItem(itemData);

            if (result.success) {
                await loadItems();
                await loadStatistics();
                hideLoading();
                alert(`‚úÖ Item ${state.editingItem ? 'atualizado' : 'cadastrado'}!`);
                state.editingItem = null;
                state.view = 'stock';
                render();
            } else {
                hideLoading();
                alert('Erro: ' + result.error);
            }
        }

        async function handleDeleteItem(itemId) {
            if (!confirm('Excluir este item?')) return;

            showLoading('Excluindo...');

            const result = await deleteItem(itemId, state.currentAlmoxarifado);

            if (result.success) {
                await loadItems();
                await loadStatistics();
                hideLoading();
                alert('‚úÖ Item exclu√≠do!');
                render();
            } else {
                hideLoading();
                alert('Erro: ' + result.error);
            }
        }

        // HIST√ìRICO
        async function navigateToHistory() {
            state.view = 'history';
            showLoading('Carregando hist√≥rico...');
            render();
            
            await loadMovements();
            
            hideLoading();
            render();
        }

        async function applyFilters() {
            showLoading('Buscando...');
            await loadMovements();
            hideLoading();
            render();
        }

        function getFilteredMovements() {
            let filtered = state.movements;
            
            if (state.filters.searchTerm) {
                const term = state.filters.searchTerm.toLowerCase();
                filtered = filtered.filter(m => 
                    m.itemName?.toLowerCase().includes(term) ||
                    m.employee?.toLowerCase().includes(term) ||
                    m.user?.toLowerCase().includes(term)
                );
            }
            
            return filtered;
        }

        function getPaginatedMovements() {
            const filtered = getFilteredMovements();
            const start = (state.currentPage - 1) * state.itemsPerPage;
            const end = start + state.itemsPerPage;
            return filtered.slice(start, end);
        }

        function changePage(delta) {
            const totalPages = Math.ceil(getFilteredMovements().length / state.itemsPerPage);
            const newPage = state.currentPage + delta;
            
            if (newPage >= 1 && newPage <= totalPages) {
                state.currentPage = newPage;
                render();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // RENDERIZA√á√ÉO
        function render() {
            const app = document.getElementById('app');
            
            switch(state.view) {
                case 'login':
                    app.innerHTML = renderLogin();
                    break;
                case 'dashboard':
                    app.innerHTML = renderDashboard();
                    break;
                case 'stock':
                    app.innerHTML = renderStock();
                    break;
                case 'distribution':
                    app.innerHTML = renderDistribution();
                    break;
                case 'transfer':
                    app.innerHTML = renderTransfer();
                    break;
                case 'history':
                    app.innerHTML = renderHistory();
                    break;
                case 'editItem':
                    app.innerHTML = renderEditItem();
                    break;
            }
        }

        function renderLogin() {
            return `
                <div class="min-h-screen flex flex-col justify-center items-center p-6">
                    <div class="glass p-8 rounded-2xl w-full max-w-md shadow-2xl fade-in">
                        <div class="flex justify-center mb-6 text-emerald-400">
                            <i class="ph-fill ph-package text-7xl"></i>
                        </div>
                        <h1 class="text-4xl font-bold text-center mb-2 font-mono">ALMOXARIFADO</h1>
                        <p class="text-center text-slate-400 mb-8 text-sm uppercase tracking-wider">Sistema Multi-Estoque v3.0</p>
                        
                        <form onsubmit="handleLogin(event)" class="space-y-6">
                            <div>
                                <label class="text-sm font-bold text-slate-300 block mb-2 uppercase tracking-wide">Usu√°rio</label>
                                <div class="relative">
                                    <i class="ph ph-user absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-xl"></i>
                                    <input 
                                        type="text" 
                                        id="username"
                                        class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-4 pl-12 focus:border-emerald-500 outline-none text-lg text-white"
                                        placeholder="Digite seu usu√°rio"
                                        required
                                    >
                                </div>
                            </div>
                            
                            <div>
                                <label class="text-sm font-bold text-slate-300 block mb-2 uppercase tracking-wide">Senha</label>
                                <div class="relative">
                                    <i class="ph ph-lock absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-xl"></i>
                                    <input 
                                        type="password" 
                                        id="password"
                                        class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-4 pl-12 focus:border-emerald-500 outline-none text-lg text-white"
                                        placeholder="Digite sua senha"
                                        required
                                    >
                                </div>
                            </div>
                            
                            <button 
                                type="submit" 
                                class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-4 rounded-xl shadow-lg transition-all flex items-center justify-center gap-2 uppercase tracking-wider"
                            >
                                <i class="ph ph-sign-in text-xl"></i> ENTRAR
                            </button>
                        </form>
                        
                        <div class="mt-6 text-center text-xs text-slate-500 font-mono">
                            <p>v3.0.0 | ¬© 2026 | Multi-Almoxarifado</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderHeader() {
            return `
                <header class="bg-slate-900 border-b border-slate-800 p-4 sticky top-0 z-30 shadow-lg">
                    <div class="max-w-7xl mx-auto flex justify-between items-center flex-wrap gap-4">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-emerald-500/20 rounded-lg flex items-center justify-center">
                                <i class="ph-fill ph-package text-emerald-400 text-2xl"></i>
                            </div>
                            <div>
                                <h1 class="font-bold text-xl font-mono">ALMOXARIFADO</h1>
                                <p class="text-sm text-slate-400">${state.user?.nome || 'Sistema'}</p>
                            </div>
                        </div>
                        
                        <div class="flex items-center gap-2">
                            ${state.view !== 'login' ? `
                                <select 
                                    onchange="state.currentAlmoxarifado = this.value; showLoading('Carregando...'); loadItems().then(() => { loadStatistics().then(() => { hideLoading(); render(); }); });"
                                    class="bg-slate-800 border-2 border-slate-700 rounded-lg px-4 py-2 text-sm font-semibold focus:border-emerald-500 outline-none"
                                >
                                    <option value="ALM1" ${state.currentAlmoxarifado === 'ALM1' ? 'selected' : ''}>üì¶ ALM1 - Distribui√ß√£o</option>
                                    <option value="ALM2" ${state.currentAlmoxarifado === 'ALM2' ? 'selected' : ''}>üè≠ ALM2 - Estoque</option>
                                </select>
                            ` : ''}
                        </div>
                        
                        <nav class="flex gap-2">
                            <button 
                                onclick="state.view='dashboard'; showLoading('Carregando...'); loadStatistics().then(() => { hideLoading(); render(); })"
                                class="px-4 py-2 rounded-lg hover:bg-slate-800 transition-all ${state.view === 'dashboard' ? 'bg-slate-800' : ''}"
                                title="Dashboard"
                            >
                                <i class="ph-fill ph-house text-xl"></i>
                            </button>
                            <button 
                                onclick="state.view='stock'; showLoading('Carregando...'); loadItems().then(() => { hideLoading(); render(); })"
                                class="px-4 py-2 rounded-lg hover:bg-slate-800 transition-all ${state.view === 'stock' ? 'bg-slate-800' : ''}"
                                title="Estoque"
                            >
                                <i class="ph-fill ph-warehouse text-xl"></i>
                            </button>
                            <button 
                                onclick="navigateToHistory()"
                                class="px-4 py-2 rounded-lg hover:bg-slate-800 transition-all ${state.view === 'history' ? 'bg-slate-800' : ''}"
                                title="Hist√≥rico"
                            >
                                <i class="ph-fill ph-clock-counter-clockwise text-xl"></i>
                            </button>
                            <button 
                                onclick="handleLogout()"
                                class="px-4 py-2 rounded-lg hover:bg-red-900/50 transition-all text-red-400"
                                title="Sair"
                            >
                                <i class="ph-fill ph-sign-out text-xl"></i>
                            </button>
                        </nav>
                    </div>
                </header>
            `;
        }

        function renderDashboard() {
            const stats = state.statistics || {};
            const totalItems = stats.totalItems || 0;
            const totalQuantity = stats.totalQuantity || 0;
            const lowStock = stats.lowStock || 0;

            const almLabel = state.currentAlmoxarifado === 'ALM1' ? 'Distribui√ß√£o' : 'Estoque';

            return `
                <div class="min-h-screen pb-6">
                    ${renderHeader()}
                    
                    <main class="p-4 max-w-7xl mx-auto space-y-6">
                        <div class="flex justify-between items-center">
                            <h1 class="text-3xl font-bold">Dashboard - ${almLabel}</h1>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 fade-in">
                            <div class="glass p-6 rounded-xl border-l-4 border-emerald-500">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-slate-400 text-sm uppercase tracking-wide font-semibold">Total de Itens</p>
                                        <p class="text-4xl font-bold font-mono mt-2">${totalItems}</p>
                                    </div>
                                    <div class="w-16 h-16 bg-emerald-500/20 rounded-xl flex items-center justify-center">
                                        <i class="ph-fill ph-package text-emerald-400 text-3xl"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="glass p-6 rounded-xl border-l-4 border-blue-500">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-slate-400 text-sm uppercase tracking-wide font-semibold">Quantidade Total</p>
                                        <p class="text-4xl font-bold font-mono mt-2">${totalQuantity}</p>
                                    </div>
                                    <div class="w-16 h-16 bg-blue-500/20 rounded-xl flex items-center justify-center">
                                        <i class="ph-fill ph-stack text-blue-400 text-3xl"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="glass p-6 rounded-xl border-l-4 border-amber-500">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-slate-400 text-sm uppercase tracking-wide font-semibold">Estoque Baixo</p>
                                        <p class="text-4xl font-bold font-mono mt-2">${lowStock}</p>
                                    </div>
                                    <div class="w-16 h-16 bg-amber-500/20 rounded-xl flex items-center justify-center">
                                        <i class="ph-fill ph-warning text-amber-400 text-3xl"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="glass p-6 rounded-xl">
                            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                                <i class="ph-fill ph-lightning text-amber-400"></i>
                                A√ß√µes R√°pidas
                            </h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <button onclick="startDistribution()" class="glass p-6 rounded-lg hover:border-emerald-500 border-2 border-transparent transition-all text-left group">
                                    <div class="w-12 h-12 bg-emerald-500/20 rounded-lg flex items-center justify-center mb-3 group-hover:scale-110 transition-transform">
                                        <i class="ph-fill ph-hand-coins text-emerald-400 text-2xl"></i>
                                    </div>
                                    <h3 class="font-bold text-lg mb-1">Distribuir EPI</h3>
                                    <p class="text-slate-400 text-sm">Entrega ao colaborador</p>
                                </button>

                                <button onclick="startTransfer()" class="glass p-6 rounded-lg hover:border-indigo-500 border-2 border-transparent transition-all text-left group">
                                    <div class="w-12 h-12 bg-indigo-500/20 rounded-lg flex items-center justify-center mb-3 group-hover:scale-110 transition-transform">
                                        <i class="ph-fill ph-swap text-indigo-400 text-2xl"></i>
                                    </div>
                                    <h3 class="font-bold text-lg mb-1">Transferir</h3>
                                    <p class="text-slate-400 text-sm">Entre almoxarifados</p>
                                </button>

                                <button onclick="state.view='stock'; showLoading('Carregando...'); loadItems().then(() => { hideLoading(); render(); })" class="glass p-6 rounded-lg hover:border-blue-500 border-2 border-transparent transition-all text-left group">
                                    <div class="w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center mb-3 group-hover:scale-110 transition-transform">
                                        <i class="ph-fill ph-warehouse text-blue-400 text-2xl"></i>
                                    </div>
                                    <h3 class="font-bold text-lg mb-1">Ver Estoque</h3>
                                    <p class="text-slate-400 text-sm">Invent√°rio completo</p>
                                </button>

                                <button onclick="navigateToHistory()" class="glass p-6 rounded-lg hover:border-purple-500 border-2 border-transparent transition-all text-left group">
                                    <div class="w-12 h-12 bg-purple-500/20 rounded-lg flex items-center justify-center mb-3 group-hover:scale-110 transition-transform">
                                        <i class="ph-fill ph-clock-counter-clockwise text-purple-400 text-2xl"></i>
                                    </div>
                                    <h3 class="font-bold text-lg mb-1">Hist√≥rico</h3>
                                    <p class="text-slate-400 text-sm">Ver movimenta√ß√µes</p>
                                </button>
                            </div>
                        </div>

                        <div class="glass p-6 rounded-xl">
                            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                                <i class="ph-fill ph-list text-blue-400"></i>
                                Itens em ${almLabel}
                            </h2>
                            ${state.items.length === 0 ? `
                                <div class="text-center py-12 text-slate-500">
                                    <i class="ph ph-package text-6xl mb-4 opacity-50"></i>
                                    <p>Nenhum item cadastrado</p>
                                    <button onclick="openNewItem()" class="mt-4 bg-emerald-600 hover:bg-emerald-700 px-6 py-3 rounded-lg font-bold">
                                        Cadastrar Item
                                    </button>
                                </div>
                            ` : `
                                <div class="space-y-2">
                                    ${state.items.slice(0, 5).map(item => `
                                        <div class="glass p-4 rounded-lg flex items-center justify-between hover:border-slate-600 border-2 border-transparent transition-all">
                                            <div class="flex-1">
                                                <h3 class="font-bold text-lg">${item.nome}</h3>
                                                <div class="flex gap-2 mt-1 flex-wrap">
                                                    <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded-full font-semibold">${item.categoria}</span>
                                                    ${item.ca ? `<span class="text-xs px-2 py-1 bg-purple-500/20 text-purple-400 rounded-full font-mono">CA ${item.ca}</span>` : ''}
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <p class="text-2xl font-bold font-mono ${item.quantidade < 10 ? 'text-amber-400' : 'text-emerald-400'}">${item.quantidade}</p>
                                                <p class="text-xs text-slate-500 uppercase">${item.unidade}</p>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            `}
                        </div>
                    </main>
                </div>
            `;
        }

        function renderStock() {
            return `
                <div class="min-h-screen pb-6">
                    ${renderHeader()}
                    
                    <main class="p-4 max-w-7xl mx-auto space-y-6">
                        <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
                            <h1 class="text-3xl font-bold flex items-center gap-3">
                                <i class="ph-fill ph-warehouse text-emerald-400"></i>
                                Estoque - ${state.currentAlmoxarifado === 'ALM1' ? 'Distribui√ß√£o' : 'Estoque Principal'}
                            </h1>
                            <button onclick="openNewItem()" class="bg-emerald-600 hover:bg-emerald-700 px-6 py-3 rounded-lg font-bold flex items-center gap-2 transition-all">
                                <i class="ph-fill ph-plus-circle text-xl"></i>
                                Novo Item
                            </button>
                        </div>

                        ${state.items.length === 0 ? `
                            <div class="glass p-12 rounded-xl text-center">
                                <i class="ph ph-package text-8xl text-slate-600 mb-4"></i>
                                <p class="text-slate-400 text-xl mb-6">Nenhum item cadastrado</p>
                                <button onclick="openNewItem()" class="bg-emerald-600 hover:bg-emerald-700 px-8 py-4 rounded-lg font-bold">
                                    Cadastrar Primeiro Item
                                </button>
                            </div>
                        ` : `
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                ${state.items.map(item => `
                                    <div class="glass p-6 rounded-xl hover:border-emerald-500 border-2 border-transparent transition-all fade-in">
                                        <div class="flex justify-between items-start mb-4">
                                            <div class="flex-1">
                                                <h3 class="font-bold text-xl mb-2">${item.nome}</h3>
                                                <div class="flex gap-2 flex-wrap">
                                                    <span class="text-xs px-3 py-1 bg-blue-500/20 text-blue-400 rounded-full font-semibold">${item.categoria}</span>
                                                    <span class="text-xs px-3 py-1 bg-slate-500/20 text-slate-400 rounded-full font-mono">${item.unidade}</span>
                                                    ${item.ca ? `<span class="text-xs px-3 py-1 bg-purple-500/20 text-purple-400 rounded-full font-mono">CA ${item.ca}</span>` : ''}
                                                </div>
                                            </div>
                                        </div>

                                        <div class="mb-4">
                                            <div class="flex justify-between items-end mb-2">
                                                <span class="text-slate-400 text-sm uppercase">Quantidade</span>
                                                <span class="text-3xl font-bold font-mono ${item.quantidade < 10 ? 'text-amber-400' : 'text-emerald-400'}">${item.quantidade}</span>
                                            </div>
                                            ${item.quantidade < 10 ? `
                                                <div class="bg-amber-500/20 border border-amber-500 text-amber-400 px-3 py-2 rounded-lg text-xs font-semibold flex items-center gap-2">
                                                    <i class="ph-fill ph-warning"></i>
                                                    ESTOQUE BAIXO
                                                </div>
                                            ` : ''}
                                        </div>

                                        ${item.localizacao ? `
                                            <p class="text-slate-400 text-sm mb-2 flex items-center gap-2">
                                                <i class="ph ph-map-pin"></i>
                                                ${item.localizacao}
                                            </p>
                                        ` : ''}

                                        ${item.validade ? `
                                            <p class="text-slate-400 text-sm mb-4 flex items-center gap-2">
                                                <i class="ph ph-calendar"></i>
                                                Validade: ${formatDate(item.validade)}
                                            </p>
                                        ` : ''}

                                        <div class="flex gap-2 pt-4 border-t border-slate-700">
                                            <button onclick='openEditItem(${JSON.stringify(item).replace(/'/g, "&#39;")})' class="flex-1 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-semibold transition-all flex items-center justify-center gap-2">
                                                <i class="ph ph-pencil-simple"></i>
                                                Editar
                                            </button>
                                            <button onclick="handleDeleteItem('${item.id}')" class="bg-red-600/20 hover:bg-red-600 text-red-400 hover:text-white px-4 py-2 rounded-lg font-semibold transition-all flex items-center justify-center gap-2 border border-red-500">
                                                <i class="ph ph-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </main>
                </div>
            `;
        }

        function renderDistribution() {
            const availableItems = state.items.filter(item => item.quantidade > 0);
            const selectedItem = availableItems.find(item => item.id === state.distributionOperation.selectedItem);

            return `
                <div class="min-h-screen pb-6">
                    ${renderHeader()}
                    
                    <main class="p-4 max-w-3xl mx-auto">
                        <div class="glass p-8 rounded-xl">
                            <div class="flex items-center justify-between mb-6">
                                <h1 class="text-3xl font-bold flex items-center gap-3">
                                    <i class="ph-fill ph-hand-coins text-emerald-400"></i>
                                    Distribuir EPI
                                </h1>
                                <button onclick="cancelDistribution()" class="text-slate-400 hover:text-white transition-all">
                                    <i class="ph ph-x text-3xl"></i>
                                </button>
                            </div>

                            ${availableItems.length === 0 ? `
                                <div class="text-center py-12 text-slate-500">
                                    <i class="ph ph-warning-circle text-8xl mb-4 text-amber-500"></i>
                                    <p class="text-xl mb-4">Nenhum item dispon√≠vel em ${state.currentAlmoxarifado === 'ALM1' ? 'Distribui√ß√£o' : 'Estoque'}</p>
                                    <button onclick="cancelDistribution()" class="bg-slate-700 hover:bg-slate-600 px-6 py-3 rounded-lg font-bold">
                                        Voltar
                                    </button>
                                </div>
                            ` : `
                                <form onsubmit="event.preventDefault(); confirmDistribution();" class="space-y-6">
                                    <div>
                                        <label class="text-sm font-bold text-slate-300 block mb-3 uppercase tracking-wide">Selecione o Item</label>
                                        <select 
                                            onchange="state.distributionOperation.selectedItem = this.value; render()"
                                            class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-4 focus:border-emerald-500 outline-none text-lg text-white"
                                            required
                                        >
                                            <option value="">-- Escolha um item --</option>
                                            ${availableItems.map(item => `
                                                <option value="${item.id}" ${state.distributionOperation.selectedItem === item.id ? 'selected' : ''}>
                                                    ${item.nome} - ${item.categoria} (Dispon√≠vel: ${item.quantidade})
                                                </option>
                                            `).join('')}
                                        </select>
                                    </div>

                                    ${selectedItem ? `
                                        <div class="glass p-4 rounded-lg border-2 border-emerald-500/50">
                                            <div class="flex justify-between items-center">
                                                <div>
                                                    <p class="text-slate-400 text-sm">Item Selecionado</p>
                                                    <p class="font-bold text-lg">${selectedItem.nome}</p>
                                                </div>
                                                <div class="text-right">
                                                    <p class="text-slate-400 text-sm">Dispon√≠vel</p>
                                                    <p class="font-bold text-2xl font-mono text-emerald-400">${selectedItem.quantidade}</p>
                                                </div>
                                            </div>
                                        </div>
                                    ` : ''}

                                    <div>
                                        <label class="text-sm font-bold text-slate-300 block mb-3 uppercase tracking-wide">Nome do Colaborador *</label>
                                        <input 
                                            type="text"
                                            value="${state.distributionOperation.employeeName}"
                                            oninput="state.distributionOperation.employeeName = this.value"
                                            class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-4 focus:border-emerald-500 outline-none text-lg text-white"
                                            placeholder="Digite o nome completo"
                                            required
                                        >
                                    </div>

                                    <div>
                                        <label class="text-sm font-bold text-slate-300 block mb-3 uppercase tracking-wide">Quantidade *</label>
                                        <input 
                                            type="number"
                                            value="${state.distributionOperation.quantity}"
                                            oninput="state.distributionOperation.quantity = parseInt(this.value) || 1"
                                            min="1"
                                            max="${selectedItem ? selectedItem.quantidade : 999}"
                                            class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-4 focus:border-emerald-500 outline-none text-lg text-white font-mono"
                                            required
                                        >
                                    </div>

                                    <div>
                                        <label class="text-sm font-bold text-slate-300 block mb-3 uppercase tracking-wide">Observa√ß√µes</label>
                                        <textarea 
                                            oninput="state.distributionOperation.observations = this.value"
                                            class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-4 focus:border-emerald-500 outline-none text-lg text-white"
                                            rows="3"
                                            placeholder="Informa√ß√µes adicionais (opcional)"
                                        >${state.distributionOperation.observations}</textarea>
                                    </div>

                                    <div class="flex gap-4 pt-6">
                                        <button 
                                            type="button"
                                            onclick="cancelDistribution()"
                                            class="flex-1 bg-slate-700 hover:bg-slate-600 text-white font-bold py-4 rounded-xl transition-all"
                                        >
                                            CANCELAR
                                        </button>
                                        <button 
                                            type="submit"
                                            class="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-4 rounded-xl transition-all flex items-center justify-center gap-2"
                                        >
                                            <i class="ph ph-check-circle text-xl"></i> CONFIRMAR DISTRIBUI√á√ÉO
                                        </button>
                                    </div>
                                </form>
                            `}
                        </div>
                    </main>
                </div>
            `;
        }

        function renderTransfer() {
            return `
                <div class="min-h-screen pb-6">
                    ${renderHeader()}
                    
                    <main class="p-4 max-w-3xl mx-auto">
                        <div class="glass p-8 rounded-xl">
                            <div class="flex items-center justify-between mb-6">
                                <h1 class="text-3xl font-bold flex items-center gap-3">
                                    <i class="ph-fill ph-swap text-indigo-400"></i>
                                    Transferir entre Almoxarifados
                                </h1>
                                <button onclick="cancelTransfer()" class="text-slate-400 hover:text-white transition-all">
                                    <i class="ph ph-x text-3xl"></i>
                                </button>
                            </div>

                            <form onsubmit="event.preventDefault(); confirmTransfer();" class="space-y-6">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-sm font-bold text-slate-300 block mb-3 uppercase tracking-wide">Origem</label>
                                        <select 
                                            onchange="state.transferOperation.origem = this.value; render()"
                                            class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-4 focus:border-indigo-500 outline-none text-lg text-white"
                                        >
                                            <option value="ALM1" ${state.transferOperation.origem === 'ALM1' ? 'selected' : ''}>ALM1 - Distribui√ß√£o</option>
                                            <option value="ALM2" ${state.transferOperation.origem === 'ALM2' ? 'selected' : ''}>ALM2 - Estoque</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="text-sm font-bold text-slate-300 block mb-3 uppercase tracking-wide">Destino</label>
                                        <select 
                                            onchange="state.transferOperation.destino = this.value; render()"
                                            class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-4 focus:border-indigo-500 outline-none text-lg text-white"
                                        >
                                            <option value="ALM1" ${state.transferOperation.destino === 'ALM1' ? 'selected' : ''}>ALM1 - Distribui√ß√£o</option>
                                            <option value="ALM2" ${state.transferOperation.destino === 'ALM2' ? 'selected' : ''}>ALM2 - Estoque</option>
                                        </select>
                                    </div>
                                </div>

                                <div>
                                    <label class="text-sm font-bold text-slate-300 block mb-3 uppercase tracking-wide">Selecione o Item (do almoxarifado de origem)</label>
                                    <input 
                                        type="text"
                                        id="transferItemId"
                                        oninput="state.transferOperation.selectedItem = this.value"
                                        value="${state.transferOperation.selectedItem || ''}"
                                        class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-4 focus:border-indigo-500 outline-none text-lg text-white font-mono"
                                        placeholder="Digite o ID do item (ex: ITEM-001)"
                                        required
                                    >
                                    <p class="text-xs text-slate-500 mt-2">üí° Dica: Consulte o ID do item na tela de Estoque</p>
                                </div>

                                <div>
                                    <label class="text-sm font-bold text-slate-300 block mb-3 uppercase tracking-wide">Quantidade *</label>
                                    <input 
                                        type="number"
                                        value="${state.transferOperation.quantity}"
                                        oninput="state.transferOperation.quantity = parseInt(this.value) || 1"
                                        min="1"
                                        class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-4 focus:border-indigo-500 outline-none text-lg text-white font-mono"
                                        required
                                    >
                                </div>

                                <div>
                                    <label class="text-sm font-bold text-slate-300 block mb-3 uppercase tracking-wide">Observa√ß√µes</label>
                                    <textarea 
                                        oninput="state.transferOperation.observations = this.value"
                                        class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-4 focus:border-indigo-500 outline-none text-lg text-white"
                                        rows="3"
                                        placeholder="Motivo da transfer√™ncia (opcional)"
                                    >${state.transferOperation.observations}</textarea>
                                </div>

                                <div class="bg-indigo-500/10 border-2 border-indigo-500/50 rounded-lg p-4">
                                    <h3 class="font-bold text-indigo-300 mb-2 flex items-center gap-2">
                                        <i class="ph-fill ph-info"></i>
                                        Resumo da Transfer√™ncia
                                    </h3>
                                    <p class="text-sm text-slate-300">
                                        <strong>De:</strong> ${state.transferOperation.origem === 'ALM1' ? 'Almoxarifado 1 (Distribui√ß√£o)' : 'Almoxarifado 2 (Estoque)'}<br>
                                        <strong>Para:</strong> ${state.transferOperation.destino === 'ALM1' ? 'Almoxarifado 1 (Distribui√ß√£o)' : 'Almoxarifado 2 (Estoque)'}<br>
                                        <strong>Quantidade:</strong> ${state.transferOperation.quantity}
                                    </p>
                                </div>

                                <div class="flex gap-4 pt-6">
                                    <button 
                                        type="button"
                                        onclick="cancelTransfer()"
                                        class="flex-1 bg-slate-700 hover:bg-slate-600 text-white font-bold py-4 rounded-xl transition-all"
                                    >
                                        CANCELAR
                                    </button>
                                    <button 
                                        type="submit"
                                        class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-xl transition-all flex items-center justify-center gap-2"
                                    >
                                        <i class="ph ph-swap text-xl"></i> CONFIRMAR TRANSFER√äNCIA
                                    </button>
                                </div>
                            </form>
                        </div>
                    </main>
                </div>
            `;
        }

        function renderHistory() {
            const filteredMovements = getFilteredMovements();
            const paginatedMovements = getPaginatedMovements();
            const totalPages = Math.ceil(filteredMovements.length / state.itemsPerPage);

            return `
                <div class="min-h-screen pb-6">
                    ${renderHeader()}
                    
                    <main class="p-4 max-w-7xl mx-auto space-y-6">
                        <h1 class="text-3xl font-bold flex items-center gap-3">
                            <i class="ph-fill ph-clock-counter-clockwise text-purple-400"></i>
                            Hist√≥rico de Movimenta√ß√µes
                        </h1>

                        <div class="glass p-6 rounded-xl">
                            <h2 class="font-bold mb-4 flex items-center gap-2 text-lg">
                                <i class="ph ph-funnel text-blue-400"></i>
                                Filtros
                            </h2>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div>
                                    <label class="text-xs font-bold text-slate-400 block mb-2 uppercase">Data Inicial</label>
                                    <input 
                                        type="date"
                                        value="${state.filters.startDate}"
                                        onchange="state.filters.startDate = this.value"
                                        class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-3 focus:border-blue-500 outline-none text-white"
                                    >
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-slate-400 block mb-2 uppercase">Data Final</label>
                                    <input 
                                        type="date"
                                        value="${state.filters.endDate}"
                                        onchange="state.filters.endDate = this.value"
                                        class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-3 focus:border-blue-500 outline-none text-white"
                                    >
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-slate-400 block mb-2 uppercase">Tipo</label>
                                    <select 
                                        onchange="state.filters.type = this.value"
                                        class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-3 focus:border-blue-500 outline-none text-white"
                                    >
                                        <option value="TODOS" ${state.filters.type === 'TODOS' ? 'selected' : ''}>Todos</option>
                                        ${Object.entries(MOVEMENT_TYPES).map(([code, info]) => `
                                            <option value="${code}" ${state.filters.type === code ? 'selected' : ''}>${info.label}</option>
                                        `).join('')}
                                    </select>
                                </div>
                                <div class="flex items-end">
                                    <button 
                                        onclick="applyFilters()"
                                        class="w-full bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg font-bold transition-all flex items-center justify-center gap-2"
                                    >
                                        <i class="ph ph-magnifying-glass"></i>
                                        BUSCAR
                                    </button>
                                </div>
                            </div>

                            <div class="mt-4">
                                <label class="text-xs font-bold text-slate-400 block mb-2 uppercase">Pesquisar</label>
                                <input 
                                    type="text"
                                    value="${state.filters.searchTerm}"
                                    oninput="state.filters.searchTerm = this.value; render()"
                                    class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-3 focus:border-blue-500 outline-none text-white"
                                    placeholder="Buscar por item, colaborador ou usu√°rio..."
                                >
                            </div>
                        </div>

                        <div class="glass p-6 rounded-xl">
                            <div class="flex justify-between items-center mb-4">
                                <p class="text-slate-400">
                                    Mostrando <span class="font-bold text-white">${paginatedMovements.length}</span> de <span class="font-bold text-white">${filteredMovements.length}</span> registros
                                </p>
                                <p class="text-slate-400 font-mono text-sm">
                                    P√°gina ${state.currentPage} de ${totalPages || 1}
                                </p>
                            </div>

                            ${filteredMovements.length === 0 ? `
                                <div class="text-center py-12 text-slate-500">
                                    <i class="ph ph-database text-8xl mb-4 opacity-50"></i>
                                    <p class="text-xl">Nenhuma movimenta√ß√£o encontrada</p>
                                    <p class="text-sm mt-2">Tente ajustar os filtros</p>
                                </div>
                            ` : `
                                <div class="space-y-2">
                                    ${paginatedMovements.map(movement => {
                                        const typeInfo = MOVEMENT_TYPES[movement.type];
                                        return `
                                            <div class="glass p-4 rounded-lg hover:border-${typeInfo.color}-500 border-2 border-transparent transition-all">
                                                <div class="flex items-start justify-between gap-4 flex-wrap">
                                                    <div class="flex-1">
                                                        <div class="flex items-center gap-3 mb-2 flex-wrap">
                                                            <div class="w-10 h-10 bg-${typeInfo.color}-600 rounded-lg flex items-center justify-center flex-shrink-0">
                                                                <i class="ph-fill ph-${typeInfo.icon} text-white text-xl"></i>
                                                            </div>
                                                            <div>
                                                                <h3 class="font-bold text-lg">${movement.itemName}</h3>
                                                                <span class="text-xs px-2 py-1 ${getColorClass(typeInfo.color)} rounded-full font-semibold uppercase">${typeInfo.label}</span>
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="ml-13 space-y-1 text-sm text-slate-400">
                                                            ${movement.employee ? `
                                                                <p class="flex items-center gap-2">
                                                                    <i class="ph ph-user"></i>
                                                                    <span class="font-semibold">Colaborador:</span> ${movement.employee}
                                                                </p>
                                                            ` : ''}
                                                            <p class="flex items-center gap-2">
                                                                <i class="ph ph-calendar"></i>
                                                                <span class="font-semibold">Data:</span> ${formatDate(movement.date)}
                                                            </p>
                                                            <p class="flex items-center gap-2">
                                                                <i class="ph ph-user-circle"></i>
                                                                <span class="font-semibold">Respons√°vel:</span> ${movement.user}
                                                            </p>
                                                            ${movement.almoxarifado ? `
                                                                <p class="flex items-center gap-2">
                                                                    <i class="ph ph-warehouse"></i>
                                                                    <span class="font-semibold">Almoxarifado:</span> ${movement.almoxarifado === 'ALM1' ? 'Distribui√ß√£o' : 'Estoque'}
                                                                    ${movement.almoxarifadoDestino ? ` ‚Üí ${movement.almoxarifadoDestino === 'ALM1' ? 'Distribui√ß√£o' : 'Estoque'}` : ''}
                                                                </p>
                                                            ` : ''}
                                                            ${movement.observations ? `
                                                                <p class="flex items-center gap-2">
                                                                    <i class="ph ph-note"></i>
                                                                    <span class="font-semibold">Obs:</span> ${movement.observations}
                                                                </p>
                                                            ` : ''}
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="text-right flex-shrink-0">
                                                        <p class="text-3xl font-bold font-mono ${movement.type === 'ENTRADA' || movement.type === 'TRANSFERENCIA' ? 'text-emerald-400' : 'text-red-400'}">
                                                            ${movement.type === 'ENTRADA' ? '+' : movement.type === 'TRANSFERENCIA' ? '‚áÑ' : '-'}${movement.quantity}
                                                        </p>
                                                        <p class="text-xs text-slate-500 mt-1">${formatDateTime(movement.timestamp)}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>

                                ${totalPages > 1 ? `
                                    <div class="flex justify-center items-center gap-2 mt-6 pt-6 border-t border-slate-700 flex-wrap">
                                        <button 
                                            onclick="changePage(-1)"
                                            ${state.currentPage === 1 ? 'disabled' : ''}
                                            class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                                        >
                                            <i class="ph ph-caret-left"></i>
                                            Anterior
                                        </button>
                                        
                                        <div class="flex gap-2">
                                            ${Array.from({length: Math.min(totalPages, 5)}, (_, i) => {
                                                let pageNum;
                                                if (totalPages <= 5) {
                                                    pageNum = i + 1;
                                                } else if (state.currentPage <= 3) {
                                                    pageNum = i + 1;
                                                } else if (state.currentPage >= totalPages - 2) {
                                                    pageNum = totalPages - 4 + i;
                                                } else {
                                                    pageNum = state.currentPage - 2 + i;
                                                }
                                                return `
                                                    <button 
                                                        onclick="state.currentPage = ${pageNum}; render(); window.scrollTo({top: 0, behavior: 'smooth'})"
                                                        class="w-10 h-10 rounded-lg font-bold ${state.currentPage === pageNum ? 'bg-blue-600' : 'bg-slate-700 hover:bg-slate-600'} transition-all"
                                                    >
                                                        ${pageNum}
                                                    </button>
                                                `;
                                            }).join('')}
                                        </div>
                                        
                                        <button 
                                            onclick="changePage(1)"
                                            ${state.currentPage === totalPages ? 'disabled' : ''}
                                            class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                                        >
                                            Pr√≥xima
                                            <i class="ph ph-caret-right"></i>
                                        </button>
                                    </div>
                                ` : ''}
                            `}
                        </div>
                    </main>
                </div>
            `;
        }

        function renderEditItem() {
            const item = state.editingItem || {};
            const isEdit = !!state.editingItem;

            return `
                <div class="min-h-screen pb-6">
                    ${renderHeader()}
                    
                    <main class="p-4 max-w-3xl mx-auto">
                        <div class="glass p-8 rounded-xl">
                            <div class="flex items-center justify-between mb-6">
                                <h1 class="text-3xl font-bold flex items-center gap-3">
                                    <i class="ph-fill ph-${isEdit ? 'pencil-simple' : 'plus-circle'} text-amber-400"></i>
                                    ${isEdit ? 'Editar Item' : 'Novo Item'}
                                </h1>
                                <button onclick="state.view='stock'; render()" class="text-slate-400 hover:text-white transition-all">
                                    <i class="ph ph-x text-3xl"></i>
                                </button>
                            </div>

                            <form onsubmit="handleSaveItem(event)" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="md:col-span-2">
                                        <label class="text-sm font-bold text-slate-300 block mb-3 uppercase tracking-wide">Nome do Item *</label>
                                        <input 
                                            type="text"
                                            id="itemName"
                                            value="${item.nome || ''}"
                                            class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-4 focus:border-amber-500 outline-none text-lg text-white"
                                            placeholder="Ex: Capacete de Seguran√ßa"
                                            required
                                        >
                                    </div>

                                    <div>
                                        <label class="text-sm font-bold text-slate-300 block mb-3 uppercase tracking-wide">Categoria *</label>
                                        <select 
                                            id="itemCategory"
                                            class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-4 focus:border-amber-500 outline-none text-lg text-white"
                                            required
                                        >
                                            <option value="">Selecione...</option>
                                            <option value="Prote√ß√£o Individual" ${item.categoria === 'Prote√ß√£o Individual' ? 'selected' : ''}>Prote√ß√£o Individual</option>
                                            <option value="Ferramentas" ${item.categoria === 'Ferramentas' ? 'selected' : ''}>Ferramentas</option>
                                            <option value="Uniformes" ${item.categoria === 'Uniformes' ? 'selected' : ''}>Uniformes</option>
                                            <option value="Outros" ${item.categoria === 'Outros' ? 'selected' : ''}>Outros</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label class="text-sm font-bold text-slate-300 block mb-3 uppercase tracking-wide">Unidade *</label>
                                        <select 
                                            id="itemUnit"
                                            class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-4 focus:border-amber-500 outline-none text-lg text-white"
                                            required
                                        >
                                            <option value="">Selecione...</option>
                                            <option value="UN" ${item.unidade === 'UN' ? 'selected' : ''}>Unidade (UN)</option>
                                            <option value="PAR" ${item.unidade === 'PAR' ? 'selected' : ''}>Par (PAR)</option>
                                            <option value="CX" ${item.unidade === 'CX' ? 'selected' : ''}>Caixa (CX)</option>
                                            <option value="KG" ${item.unidade === 'KG' ? 'selected' : ''}>Quilograma (KG)</option>
                                            <option value="LT" ${item.unidade === 'LT' ? 'selected' : ''}>Litro (LT)</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label class="text-sm font-bold text-slate-300 block mb-3 uppercase tracking-wide">Quantidade *</label>
                                        <input 
                                            type="number"
                                            id="itemQuantity"
                                            value="${item.quantidade || 0}"
                                            min="0"
                                            class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-4 focus:border-amber-500 outline-none text-lg text-white font-mono"
                                            required
                                        >
                                    </div>

                                    <div>
                                        <label class="text-sm font-bold text-slate-300 block mb-3 uppercase tracking-wide">CA (Certificado)</label>
                                        <input 
                                            type="text"
                                            id="itemCA"
                                            value="${item.ca || ''}"
                                            class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-4 focus:border-amber-500 outline-none text-lg text-white font-mono"
                                            placeholder="Ex: 12345"
                                        >
                                    </div>

                                    <div>
                                        <label class="text-sm font-bold text-slate-300 block mb-3 uppercase tracking-wide">Validade</label>
                                        <input 
                                            type="date"
                                            id="itemValidity"
                                            value="${item.validade || ''}"
                                            class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-4 focus:border-amber-500 outline-none text-lg text-white"
                                        >
                                    </div>

                                    <div>
                                        <label class="text-sm font-bold text-slate-300 block mb-3 uppercase tracking-wide">Localiza√ß√£o</label>
                                        <input 
                                            type="text"
                                            id="itemLocation"
                                            value="${item.localizacao || ''}"
                                            class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-4 focus:border-amber-500 outline-none text-lg text-white"
                                            placeholder="Ex: Prateleira A1"
                                        >
                                    </div>

                                    <div class="md:col-span-2">
                                        <label class="text-sm font-bold text-slate-300 block mb-3 uppercase tracking-wide">Observa√ß√µes</label>
                                        <textarea 
                                            id="itemObs"
                                            class="w-full bg-slate-800/50 border-2 border-slate-700 rounded-lg p-4 focus:border-amber-500 outline-none text-lg text-white"
                                            rows="3"
                                            placeholder="Informa√ß√µes adicionais..."
                                        >${item.observacoes || ''}</textarea>
                                    </div>
                                </div>

                                <div class="flex gap-4 pt-6 border-t border-slate-700">
                                    <button 
                                        type="button"
                                        onclick="state.view='stock'; render()"
                                        class="flex-1 bg-slate-700 hover:bg-slate-600 text-white font-bold py-4 rounded-xl transition-all"
                                    >
                                        CANCELAR
                                    </button>
                                    <button 
                                        type="submit"
                                        class="flex-1 bg-amber-600 hover:bg-amber-700 text-white font-bold py-4 rounded-xl transition-all flex items-center justify-center gap-2"
                                    >
                                        <i class="ph ph-floppy-disk text-xl"></i> ${isEdit ? 'ATUALIZAR' : 'CADASTRAR'}
                                    </button>
                                </div>
                            </form>
                        </div>
                    </main>
                </div>
            `;
        }

        // INICIALIZA√á√ÉO
        document.addEventListener('DOMContentLoaded', () => {
            const savedUser = localStorage.getItem('user');
            if (savedUser) {
                state.user = JSON.parse(savedUser);
                showLoading('Carregando dados...');
                render();
                
                loadItems().then(() => {
                    loadStatistics().then(() => {
                        state.view = 'dashboard';
                        hideLoading();
                        render();
                    });
                });
            } else {
                render();
            }
        });
    </script>
</body>
</html>
